name: Deploy Documentation

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Deploy
        run: |
          # Configure git
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # Create and populate docs directory
          mkdir -p docs
          
          # Copy C++ docs if they exist
          if [ -d "projects/ghost_os_cpp/docs/html" ]; then
            cp -r projects/ghost_os_cpp/docs/html/* docs/
          fi
          
          # Copy curriculum docs if they exist
          if [ -d "projects/cpp_learning_lab/curriculum" ]; then
            mkdir -p docs/curriculum
            cp -r projects/cpp_learning_lab/curriculum/* docs/curriculum/
          fi
          
          # Create index file
          echo '<!DOCTYPE html>
          <html>
          <head>
            <title>Project Documentation</title>
            <meta http-equiv="refresh" content="0; url=./html/index.html">
          </head>
          <body>
            <p>Redirecting to documentation...</p>
          </body>
          </html>' > docs/index.html
          
          # Create and switch to gh-pages branch
          git checkout --orphan gh-pages
          git rm -rf .
          
          # Move docs to root
          mv docs/* .
          rm -rf docs
          
          # Add .nojekyll file
          touch .nojekyll
          
          # Commit and push
          git add -A
          git commit -m "Deploy documentation"
          git push -f origin gh-pages
